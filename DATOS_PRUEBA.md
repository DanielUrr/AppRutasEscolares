# Script de Datos de Prueba para Firebase

Este script te ayudar√° a configurar datos de prueba en tu proyecto de Firebase.

## üîß Configuraci√≥n Inicial

### 1. Instalar Firebase CLI

```bash
npm install -g firebase-tools
firebase login
```

### 2. Inicializar Proyecto

```bash
cd transporte_escolar
firebase init
```

Selecciona:
- ‚úÖ Firestore
- ‚úÖ Functions
- ‚úÖ Authentication

## üìù Crear Usuarios de Prueba

### Opci√≥n 1: Desde Firebase Console

1. Ve a [Firebase Console](https://console.firebase.google.com/)
2. Selecciona tu proyecto
3. Ve a **Authentication** > **Users** > **Add user**

Crea los siguientes usuarios:

| Tipo | Email | Password | UID sugerido |
|------|-------|----------|--------------|
| Conductor | conductor@ejemplo.com | conductor123 | conductor001 |
| Padre | padre@ejemplo.com | padre123 | padre001 |
| Admin | admin@ejemplo.com | admin123 | admin001 |

### Opci√≥n 2: Program√°ticamente

Crea un archivo `setup_users.js` en la ra√≠z del proyecto:

```javascript
const admin = require('firebase-admin');
const serviceAccount = require('./serviceAccountKey.json');

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount)
});

const db = admin.firestore();
const auth = admin.auth();

async function crearUsuarios() {
  try {
    // Crear Conductor
    const conductor = await auth.createUser({
      uid: 'conductor001',
      email: 'conductor@ejemplo.com',
      password: 'conductor123',
      displayName: 'Juan P√©rez'
    });
    
    await db.collection('usuarios').doc('conductor001').set({
      nombre: 'Juan P√©rez',
      email: 'conductor@ejemplo.com',
      tipo: 'conductor',
      telefono: '+57 3001234567',
      fechaCreacion: admin.firestore.FieldValue.serverTimestamp()
    });
    
    console.log('‚úì Conductor creado');

    // Crear Padre
    const padre = await auth.createUser({
      uid: 'padre001',
      email: 'padre@ejemplo.com',
      password: 'padre123',
      displayName: 'Mar√≠a Garc√≠a'
    });
    
    await db.collection('usuarios').doc('padre001').set({
      nombre: 'Mar√≠a Garc√≠a',
      email: 'padre@ejemplo.com',
      tipo: 'padre',
      telefono: '+57 3007654321',
      fechaCreacion: admin.firestore.FieldValue.serverTimestamp()
    });
    
    console.log('‚úì Padre creado');

    // Crear Admin
    const administrador = await auth.createUser({
      uid: 'admin001',
      email: 'admin@ejemplo.com',
      password: 'admin123',
      displayName: 'Carlos Admin'
    });
    
    await db.collection('usuarios').doc('admin001').set({
      nombre: 'Carlos Admin',
      email: 'admin@ejemplo.com',
      tipo: 'admin',
      telefono: '+57 3009876543',
      fechaCreacion: admin.firestore.FieldValue.serverTimestamp()
    });
    
    console.log('‚úì Administrador creado');

  } catch (error) {
    console.error('Error:', error);
  }
}

crearUsuarios();
```

Ejecutar:
```bash
node setup_users.js
```

## üë• Crear Estudiantes de Prueba

Crea un archivo `setup_students.js`:

```javascript
const admin = require('firebase-admin');
const serviceAccount = require('./serviceAccountKey.json');

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount)
});

const db = admin.firestore();

async function crearEstudiantes() {
  try {
    // Estudiante 1 - Sof√≠a
    await db.collection('estudiantes').add({
      nombre: 'Sof√≠a Garc√≠a',
      grado: '3¬∞ Primaria',
      idPadre: 'padre001',
      nombrePadre: 'Mar√≠a Garc√≠a',
      ubicacionCasa: {
        latitude: 4.1520,
        longitude: -73.6350
      },
      direccion: 'Cra 40 #25-30, Villavicencio',
      telefonoEmergencia: '+57 3001112222',
      activo: true
    });
    console.log('‚úì Sof√≠a creada');

    // Estudiante 2 - Miguel
    await db.collection('estudiantes').add({
      nombre: 'Miguel Rodr√≠guez',
      grado: '5¬∞ Primaria',
      idPadre: 'padre002',
      nombrePadre: 'Ana Rodr√≠guez',
      ubicacionCasa: {
        latitude: 4.1480,
        longitude: -73.6320
      },
      direccion: 'Cra 38 #28-15, Villavicencio',
      telefonoEmergencia: '+57 3002223333',
      activo: true
    });
    console.log('‚úì Miguel creado');

    // Estudiante 3 - Valentina
    await db.collection('estudiantes').add({
      nombre: 'Valentina L√≥pez',
      grado: '4¬∞ Primaria',
      idPadre: 'padre001',
      nombrePadre: 'Mar√≠a Garc√≠a',
      ubicacionCasa: {
        latitude: 4.1505,
        longitude: -73.6340
      },
      direccion: 'Cra 42 #24-20, Villavicencio',
      telefonoEmergencia: '+57 3003334444',
      activo: true
    });
    console.log('‚úì Valentina creada');

    // Estudiante 4 - Daniel
    await db.collection('estudiantes').add({
      nombre: 'Daniel Mart√≠nez',
      grado: '2¬∞ Primaria',
      idPadre: 'padre003',
      nombrePadre: 'Pedro Mart√≠nez',
      ubicacionCasa: {
        latitude: 4.1495,
        longitude: -73.6310
      },
      direccion: 'Cra 36 #26-10, Villavicencio',
      telefonoEmergencia: '+57 3004445555',
      activo: true
    });
    console.log('‚úì Daniel creado');

    // Estudiante 5 - Isabella
    await db.collection('estudiantes').add({
      nombre: 'Isabella G√≥mez',
      grado: '1¬∞ Primaria',
      idPadre: 'padre004',
      nombrePadre: 'Laura G√≥mez',
      ubicacionCasa: {
        latitude: 4.1525,
        longitude: -73.6360
      },
      direccion: 'Cra 44 #27-05, Villavicencio',
      telefonoEmergencia: '+57 3005556666',
      activo: true
    });
    console.log('‚úì Isabella creada');

  } catch (error) {
    console.error('Error:', error);
  }
}

crearEstudiantes();
```

Ejecutar:
```bash
node setup_students.js
```

## üõ£Ô∏è Crear Ruta de Prueba

Crea un archivo `setup_routes.js`:

```javascript
const admin = require('firebase-admin');
const serviceAccount = require('./serviceAccountKey.json');

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount)
});

const db = admin.firestore();

async function crearRutas() {
  try {
    // Primero, obtener los IDs de los estudiantes creados
    const estudiantesSnapshot = await db.collection('estudiantes').get();
    const idsEstudiantes = estudiantesSnapshot.docs.map(doc => doc.id);

    // Crear Ruta 1
    await db.collection('rutas').add({
      nombre: 'Ruta Ma√±ana - Norte',
      descripcion: 'Ruta matinal para estudiantes del sector norte de Villavicencio',
      idsEstudiantes: idsEstudiantes,
      idConductor: 'conductor001',
      nombreConductor: 'Juan P√©rez',
      horaInicio: '06:00 AM',
      horaFin: '07:30 AM',
      activa: true
    });
    console.log('‚úì Ruta 1 creada');

    // Crear Ruta 2
    await db.collection('rutas').add({
      nombre: 'Ruta Tarde - Centro',
      descripcion: 'Ruta vespertina para estudiantes del sector centro',
      idsEstudiantes: idsEstudiantes.slice(0, 3),
      idConductor: 'conductor001',
      nombreConductor: 'Juan P√©rez',
      horaInicio: '12:00 PM',
      horaFin: '01:30 PM',
      activa: true
    });
    console.log('‚úì Ruta 2 creada');

  } catch (error) {
    console.error('Error:', error);
  }
}

crearRutas();
```

Ejecutar:
```bash
node setup_routes.js
```

## üî• Script Completo de Configuraci√≥n

Crea un archivo `setup_all.js` que ejecute todo:

```javascript
const admin = require('firebase-admin');
const serviceAccount = require('./serviceAccountKey.json');

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount)
});

const db = admin.firestore();
const auth = admin.auth();

async function configurarTodo() {
  console.log('üöÄ Iniciando configuraci√≥n...\n');

  try {
    // 1. Crear Usuarios
    console.log('üìù Creando usuarios...');
    
    const usuarios = [
      {
        uid: 'conductor001',
        email: 'conductor@ejemplo.com',
        password: 'conductor123',
        displayName: 'Juan P√©rez',
        tipo: 'conductor',
        telefono: '+57 3001234567'
      },
      {
        uid: 'padre001',
        email: 'padre@ejemplo.com',
        password: 'padre123',
        displayName: 'Mar√≠a Garc√≠a',
        tipo: 'padre',
        telefono: '+57 3007654321'
      },
      {
        uid: 'admin001',
        email: 'admin@ejemplo.com',
        password: 'admin123',
        displayName: 'Carlos Admin',
        tipo: 'admin',
        telefono: '+57 3009876543'
      }
    ];

    for (const usuario of usuarios) {
      try {
        await auth.createUser({
          uid: usuario.uid,
          email: usuario.email,
          password: usuario.password,
          displayName: usuario.displayName
        });

        await db.collection('usuarios').doc(usuario.uid).set({
          nombre: usuario.displayName,
          email: usuario.email,
          tipo: usuario.tipo,
          telefono: usuario.telefono,
          fechaCreacion: admin.firestore.FieldValue.serverTimestamp()
        });

        console.log(`  ‚úì ${usuario.displayName} creado`);
      } catch (error) {
        if (error.code === 'auth/email-already-exists') {
          console.log(`  ‚ö† ${usuario.email} ya existe`);
        } else {
          throw error;
        }
      }
    }

    // 2. Crear Estudiantes
    console.log('\nüë• Creando estudiantes...');
    
    const estudiantes = [
      {
        nombre: 'Sof√≠a Garc√≠a',
        grado: '3¬∞ Primaria',
        idPadre: 'padre001',
        nombrePadre: 'Mar√≠a Garc√≠a',
        ubicacionCasa: { latitude: 4.1520, longitude: -73.6350 },
        direccion: 'Cra 40 #25-30, Villavicencio',
        telefonoEmergencia: '+57 3001112222'
      },
      {
        nombre: 'Miguel Rodr√≠guez',
        grado: '5¬∞ Primaria',
        idPadre: 'padre002',
        nombrePadre: 'Ana Rodr√≠guez',
        ubicacionCasa: { latitude: 4.1480, longitude: -73.6320 },
        direccion: 'Cra 38 #28-15, Villavicencio',
        telefonoEmergencia: '+57 3002223333'
      },
      {
        nombre: 'Valentina L√≥pez',
        grado: '4¬∞ Primaria',
        idPadre: 'padre001',
        nombrePadre: 'Mar√≠a Garc√≠a',
        ubicacionCasa: { latitude: 4.1505, longitude: -73.6340 },
        direccion: 'Cra 42 #24-20, Villavicencio',
        telefonoEmergencia: '+57 3003334444'
      }
    ];

    const idsEstudiantes = [];
    for (const estudiante of estudiantes) {
      const docRef = await db.collection('estudiantes').add({
        ...estudiante,
        activo: true
      });
      idsEstudiantes.push(docRef.id);
      console.log(`  ‚úì ${estudiante.nombre} creado`);
    }

    // 3. Crear Rutas
    console.log('\nüõ£Ô∏è  Creando rutas...');
    
    await db.collection('rutas').add({
      nombre: 'Ruta Ma√±ana - Norte',
      descripcion: 'Ruta matinal para estudiantes del sector norte',
      idsEstudiantes: idsEstudiantes,
      idConductor: 'conductor001',
      nombreConductor: 'Juan P√©rez',
      horaInicio: '06:00 AM',
      horaFin: '07:30 AM',
      activa: true
    });
    console.log('  ‚úì Ruta Ma√±ana creada');

    console.log('\n‚úÖ ¬°Configuraci√≥n completa!\n');
    console.log('üì± Usuarios de prueba:');
    console.log('   Conductor: conductor@ejemplo.com / conductor123');
    console.log('   Padre: padre@ejemplo.com / padre123');
    console.log('   Admin: admin@ejemplo.com / admin123');

  } catch (error) {
    console.error('‚ùå Error:', error);
  }
}

configurarTodo();
```

## üöÄ Ejecutar Todo

1. Descarga tu clave de cuenta de servicio de Firebase:
   - Ve a Firebase Console > Project Settings > Service Accounts
   - Click en "Generate New Private Key"
   - Guarda como `serviceAccountKey.json`

2. Instala dependencias:
```bash
npm install firebase-admin
```

3. Ejecuta el script:
```bash
node setup_all.js
```

## ‚úÖ Verificaci√≥n

Despu√©s de ejecutar los scripts, verifica en Firebase Console que se hayan creado:

- ‚úÖ 3 usuarios en Authentication
- ‚úÖ 3 documentos en `usuarios` collection
- ‚úÖ 3-5 estudiantes en `estudiantes` collection
- ‚úÖ 1-2 rutas en `rutas` collection

¬°Listo! Ahora puedes iniciar sesi√≥n en la app con cualquiera de los usuarios de prueba.
